<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>Accel-Drive</title>
<style>
  *{margin:0;padding:0;box-sizing:border-box}
  body{background:#000;overflow:hidden;position:fixed;inset:0}

  #launcher{
    position:fixed;inset:0;z-index:100;
    display:flex;flex-direction:column;align-items:center;justify-content:center;
    background:linear-gradient(180deg,#12002a,#1a0040 40%,#2d0060);
    color:#e0d0ff;font-family:system-ui,sans-serif;padding:2rem;text-align:center;
  }
  h1{
    font-size:1.8rem;margin-bottom:.2rem;
    background:linear-gradient(135deg,#ff6ec7,#ffd700);
    -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  }
  .sub{font-size:.8rem;opacity:.5;margin-bottom:2rem}
  .btn{
    display:block;width:100%;max-width:320px;padding:1rem;border:none;border-radius:14px;
    font-size:1rem;font-weight:700;cursor:pointer;text-align:center;
    -webkit-tap-highlight-color:transparent;margin-bottom:.75rem;
  }
  .btn-go{background:linear-gradient(135deg,#ff6ec7,#ff3cac);color:#fff;box-shadow:0 6px 24px rgba(255,60,172,.4)}
  .hint{font-size:.72rem;opacity:.4;max-width:300px;line-height:1.4;margin-top:.5rem}

  iframe{position:fixed;inset:0;width:100%;height:100%;border:none;z-index:1}

  /* HUD */
  #hud{
    display:none;position:fixed;top:0;left:0;right:0;z-index:9999;
    background:rgba(0,0,0,.5);backdrop-filter:blur(6px);
    padding:4px 10px;font:600 11px system-ui;color:#fff;
    align-items:center;gap:8px;
  }
  #hud.on{display:flex}
  #hud span{white-space:nowrap}
  .g{color:#4f4}
</style>
</head>
<body>

<div id="launcher">
  <h1>Accel-Drive</h1>
  <p class="sub">Tilt to steer Horizon Drive</p>
  <button class="btn btn-go" id="btn-play">Play</button>
  <p class="hint">
    Loads the game and maps your phone's accelerometer to
    left/right steering. Gas is held automatically.
  </p>
</div>

<iframe id="gf" src="about:blank" allow="accelerometer;gyroscope;autoplay;fullscreen" allowfullscreen></iframe>

<div id="hud">
  <span id="hdir">STRAIGHT</span>
  <span id="htilt" style="opacity:.5">0°</span>
  <span class="g">GAS</span>
  <span style="font-size:9px;opacity:.6">Sens</span>
  <input id="hsens" type="range" min="3" max="30" value="10" style="width:40px;accent-color:#ff6ec7">
  <button id="hzero" style="background:rgba(255,255,255,.15);border:0;color:#fff;border-radius:5px;padding:2px 7px;font-size:9px">Zero</button>
  <button id="hstop" style="background:rgba(255,60,60,.4);border:0;color:#fff;border-radius:5px;padding:2px 7px;font-size:9px">Stop</button>
</div>

<script>
const GAME = 'https://www.shopify.com/editions/summer2025/drive';
const iframe = document.getElementById('gf');

let active = false, cal = 0, gm = 0, DZ = 3.3, steer = 'none', gasIv;

/*
 * Button positions from screenshot (% of viewport)
 *   ◀ left steer:  12% x, 86% y
 *   ▶ right steer: 33% x, 86% y
 *   gas (dots):    90% x, 86% y
 */
const BTN = { left: [0.12, 0.86], right: [0.33, 0.86], gas: [0.90, 0.86] };

/* Unique pointer IDs per button so multi-touch works */
const PID = { left: 2, right: 3, gas: 4 };

function btnXY(name) {
  return [BTN[name][0] * window.innerWidth, BTN[name][1] * window.innerHeight];
}

function touchDown(name) {
  const [x, y] = btnXY(name);
  const id = PID[name];
  iframe.dispatchEvent(new PointerEvent('pointerdown', {
    clientX: x, clientY: y, pointerId: id, pointerType: 'touch',
    isPrimary: id === 2, bubbles: true, cancelable: true, pressure: 0.5
  }));
  try {
    const t = new Touch({identifier: id, target: iframe, clientX: x, clientY: y, pageX: x, pageY: y});
    iframe.dispatchEvent(new TouchEvent('touchstart', {
      bubbles: true, cancelable: true, touches: [t], targetTouches: [t], changedTouches: [t]
    }));
  } catch(e) {}
}

function touchUp(name) {
  const [x, y] = btnXY(name);
  const id = PID[name];
  iframe.dispatchEvent(new PointerEvent('pointerup', {
    clientX: x, clientY: y, pointerId: id, pointerType: 'touch',
    isPrimary: id === 2, bubbles: true, cancelable: true
  }));
  try {
    const t = new Touch({identifier: id, target: iframe, clientX: x, clientY: y, pageX: x, pageY: y});
    iframe.dispatchEvent(new TouchEvent('touchend', {
      bubbles: true, cancelable: true, touches: [], targetTouches: [], changedTouches: [t]
    }));
  } catch(e) {}
}

function startGas() {
  touchDown('gas');
  gasIv = setInterval(() => { touchUp('gas'); touchDown('gas'); }, 200);
}

function stopGas() {
  clearInterval(gasIv);
  touchUp('gas');
}

function updateSteer(gamma) {
  const a = gamma - cal;
  let d = 'none';
  if (a < -DZ) d = 'left';
  else if (a > DZ) d = 'right';

  document.getElementById('htilt').textContent = Math.round(a) + '°';
  document.getElementById('hdir').textContent =
    d === 'left' ? '\u25C0 LEFT' : d === 'right' ? 'RIGHT \u25B6' : 'STRAIGHT';

  if (d === steer) return;
  if (steer === 'left') touchUp('left');
  if (steer === 'right') touchUp('right');
  if (d === 'left') touchDown('left');
  if (d === 'right') touchDown('right');
  steer = d;
}

function onOrient(e) { gm = e.gamma || 0; updateSteer(gm); }

async function launch() {
  if (typeof DeviceOrientationEvent !== 'undefined' &&
      typeof DeviceOrientationEvent.requestPermission === 'function') {
    try {
      const p = await DeviceOrientationEvent.requestPermission();
      if (p !== 'granted') { alert('Accelerometer access required'); return; }
    } catch(e) { alert('Accelerometer error: ' + e.message); return; }
  }

  document.getElementById('launcher').style.display = 'none';
  iframe.src = GAME;
  document.getElementById('hud').classList.add('on');
  active = true;

  window.addEventListener('deviceorientation', onOrient);

  // Start gas after delay for game to load
  setTimeout(startGas, 4000);
}

document.getElementById('btn-play').addEventListener('click', launch);

document.getElementById('hsens').oninput = function() {
  DZ = Math.max(1.5, (+this.value) / 3);
};
document.getElementById('hzero').onclick = function() { cal = gm; };
document.getElementById('hstop').onclick = function() {
  stopGas();
  touchUp('left');
  touchUp('right');
  window.removeEventListener('deviceorientation', onOrient);
  document.getElementById('hud').classList.remove('on');
  active = false;
};
</script>
</body>
</html>
